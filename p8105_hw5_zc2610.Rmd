---
title: "p8105_hw5_zc2610"
author: "Zuoqiao Cui"
date: "2022-11-04"
output: github_document
---

```{r}
library(tidyverse)
```
# Problem 2

```{r}
homicide_data_df = read_csv("./data/homicide-data.csv") %>% 
janitor::clean_names()
```

Raw data decription:

1. This dataset contains `r nrow(homicide_data_df)` observations and `r ncol(homicide_data_df)` variables.

2. Variables include : `r colnames(homicide_data_df)`

Create a new variable "city_state" to combine city and state columns

```{r}
homicide_data_df = homicide_data_df %>% 
  mutate(
    city_state = str_c(city, state, sep = ",")
  ) %>% 
  select(-city,-state)
```

Create a new variable to show if this homicide has been solved

```{r}
homicide_data_df = homicide_data_df %>% 
  mutate(
    whether_solved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest" ~ "unsolved",
      disposition == "Closed by arrest" ~ "solved"
    )
  )
```

Obtain the total number of homicides and the number of unsolved homicides 

```{r}
num_of_homicide_df = homicide_data_df %>% 
  group_by(city_state) %>% 
  summarise(
    homicide_total = n(),
    homicide_unsolved = sum(whether_solved == "unsolved")
  ) 
num_of_homicide_df
```

1. Estimate the proportion of homicides that are unsolved in Baltimore,MD and save the output of prop.test

2. Pull the estimated proportion and confidence intervals from the resulting tidy dataframe

```{r}
Baltimore_unsolved_homicide_df = num_of_homicide_df %>% 
  filter(city_state == "Baltimore,MD")
  x = Baltimore_unsolved_homicide_df %>%
    pull(homicide_unsolved)  
  n = Baltimore_unsolved_homicide_df %>%
    pull(homicide_total)
result_df = prop.test(x,n) %>% 
  broom::tidy()
result_df
# pull the estimated proportion and confidence intervals from the resulting tidy dataframe.
result_df %>% 
  select(estimate,conf.low,conf.high)
```

1. Estimate the proportion of homicides that are unsolved in each city

```{r}
  x = num_of_homicide_df %>%
  pull(homicide_unsolved) 
  n = num_of_homicide_df %>% 
  pull(homicide_total) 
 City_unsolved_homicide_df =  map2(x,n,prop.test)
 # Tidy hypothesis outputs of the dataframe
 Tidy_city_unsolved_homicide_df = map(City_unsolved_homicide_df, broom::tidy)
```










